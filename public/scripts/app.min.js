function getCamera(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia({audio:!1,video:{width:{max:videoSize.width},height:{max:videoSize.height}}},onSuccessMedia,onFailedMedia):void alert("Your browser no support Web Camera")}function onSuccessMedia(e){video.src=window.URL.createObjectURL(e),timer=setInterval(function(){socket.emit("stream",snapShot())},100)}function onFailedMedia(){}function snapShot(){var e=resize(video.videoWidth,video.videoHeight);return canvas.width=e.width,canvas.height=e.height,ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toDataURL("image/jpeg",.7)}function addStream(e){var a=document.createElement("div"),t=document.createElement("img"),i={id:e,image:t,loaded:!0};t.onload=function(){i.loaded=!0},a.appendChild(t),a.className="userstream-pic",userstreamContainer.appendChild(a),streams.push(i)}function updateStream(e,a){if(!(a.search("data:image/")<0)){for(var t,i=0;i<streams.length;i++)if(t=streams[i],t.id===e)return void(t.loaded&&(t.loaded=!1,t.image.src=a));addStream(e),updateStream(e,a)}}function removeStream(e){for(var a=0;a<streams.length;a++)if(streams[a].id===e)return userstreamContainer.removeChild(streams[a].image.parentNode),void streams.splice(a,1)}function resize(e,a){var t=videoSize.width,i=videoSize.height,o=0;return o=a>e?t/a:i/e,{width:e*o,height:a*o}}var videoSize={width:160,height:160},socket=io(),video=document.querySelector("video"),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),timer,streams=[],userstreamContainer=document.getElementById("userstream-container");getCamera(),socket.on("stream",function(e){updateStream(e.id,e.image)}),socket.on("join",function(e){console.log("Join %s",e),addStream(e)}),socket.on("leave",function(e){console.log("Leave %s",e),removeStream(e)});